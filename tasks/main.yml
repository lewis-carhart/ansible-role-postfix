---
  - name: Debug
    debug:
      msg: "{{ item.key }}"
      with_dict: "{{ postfix }}"

  - name: Postfix | Install Postfix
    yum:
      name: postfix
      state: present

  - name: Postfix | Write main.cf file
    template:
      src: main.cf.j2
      dest: /etc/postfix/main.cf
      owner: root
      group: root
      mode: 0644
    with_dict: "{{ postfix.main | default({}) }}"

  - name: Postfix | Write master.cf file
    template:
      src: master.cf.j2
      dest: /etc/postfix/master.cf
      owner: root
      group: root
      mode: 0644
    with_dict: "{{ postfix.master | default({}) }}"

  - name: Postfix | Write header_checks file
    template:
      src: header_checks.j2
      dest: /etc/postfix/header_checks
      owner: root
      group: root
      mode: 0644
    notify: start-postfix
    with_dict: "{{ postfix.header_checks | default({}) }}"

  - name: Postfix | Enable postfix on start up
    systemd:
      name: postfix
      enabled: yes
